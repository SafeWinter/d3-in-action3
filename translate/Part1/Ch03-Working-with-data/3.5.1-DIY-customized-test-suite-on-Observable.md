# 3.5.1 DIYå®æˆ˜ï¼šåœ¨ Observable å®ç°å¸¦æ•°æ®æ ‡ç­¾çš„ D3 æ¡å½¢å›¾å¹¶æ”¹é€ å•å…ƒæµ‹è¯•æ¨¡å—



## 1 èµ·å› 

å­¦å®Œäº†ç¬¬ä¸‰ç« ï¼Œæˆ‘ä¹Ÿåœ¨æœ¬åœ°å®æµ‹äº†ä¸€éï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚äºæ˜¯å°±æƒ³ç€åŒæ­¥æ›´æ–°ä¸€ä¸‹æ”¾åˆ° `Observable` ä¸Šçš„ç‰ˆæœ¬ã€‚æ²¡æ›¾æƒ³ç«Ÿç„¶åœ¨å•å…ƒæµ‹è¯•æ¨¡å—å¡ä½äº†ï¼š`Observable` å±…ç„¶ä¸æ”¯æŒ `Mocha.js` è¿™æ ·çš„æµ‹è¯•æ¡†æ¶ï¼Œæ— æ³•ä½¿ç”¨å…¨å±€çš„ `describe` å’Œ `it` æ–¹æ³•æ¥å†™æµ‹è¯•å¥—ä»¶ï¼é™¤äº†æ”¯æŒ `Chai.js` æ–­è¨€åº“çš„ `CDN` å¼•å…¥ï¼Œå…¶ä½™æ•ˆæœéƒ½å¾—è‡ªå·±å°è£…ã€‚ç½‘ä¸Šå€’æ˜¯æœ‰å‡ ä¸ªç°æˆçš„æ¡ˆä¾‹ï¼Œä½†è¦ä¹ˆè¿‡äºç®€å•ï¼Œåªæ˜¯ç²—ç•¥å¯¹æ–­è¨€æ¨¡å— `expect` æ–¹æ³•çš„å°è£… [^1]ï¼š

![](../../assets/3.36.1.png)

**å›¾ 1 å¯¹ Jest çš„ expect æ–­è¨€åšç®€å•å°è£…çš„æ•ˆæœå›¾**

è¦ä¹ˆåˆè¿‡äºå¤æ‚ [^2]ï¼š

![](../../assets/3.36.3.png)

**å›¾ 2 åŒæ ·åŸºäº Jest çš„ expect æ–­è¨€å®ç°çš„ä¸€å¥—å®šåˆ¶æµ‹è¯•æ¡†æ¶**

è€Œæˆ‘åªå¸Œæœ›èƒ½ç”¨ä¸Š `describe` å’Œ `it`ï¼Œæœ€åå°†å•å…ƒæµ‹è¯•å†™åˆ°ä¸€ä¸ªæµ‹è¯•å¥—ä»¶ï¼ˆsuiteï¼‰é‡Œï¼Œå¤§è‡´é•¿è¿™æ ·ï¼š

![](../../assets/3.36.2.png)

**å›¾ 3 å¸Œæœ›é€šè¿‡ç»„åˆ describe å’Œ it æ–¹æ³•å®ç°çš„å•å…ƒæµ‹è¯•æ•ˆæœ**

æ²¡åŠæ³•ï¼Œ`Observable` è¿™æ–¹é¢è¿˜ä¸æˆç†Ÿï¼Œè¿˜å¾—è‡ªåŠ›æ›´ç”Ÿã€‚



## 2 ç»è¿‡

### 2.1 å®Œæˆæ¡å½¢å›¾å‰©ä½™éƒ¨åˆ†â€”â€”ç»˜åˆ¶æ•°æ®æ ‡ç­¾

å‚è€ƒä¸Šä¸€èŠ‚åšå¥½çš„ç‰ˆæœ¬ï¼ˆè¯¦è§æˆ‘çš„ã€Š[3.4 å°èŠ‚ DIY å®æˆ˜ï¼šä½¿ç”¨ Observable åœ¨çº¿ç»˜åˆ¶ D3 æ¡å½¢å›¾](https://blog.csdn.net/frgod/article/details/142708748)ã€‹ï¼‰ï¼Œå…ˆæŠŠå¸¦æ ‡ç­¾çš„ D3 æ¡å½¢å›¾ç”»å‡ºæ¥ã€‚

å’Œä¸Šæ¬¡ä¸€æ ·ï¼Œå…ˆä¸Šä¼  `data.csv` åŸå§‹æ•°æ®é›†ï¼Œç„¶åè½¬æˆ `Observable` å¯ä»¥ä½¿ç”¨çš„å¯¹è±¡æ•°ç»„ï¼š

```js
data = {
  const csv = await FileAttachment("data.csv").csv({typed: true});
  return csv.sort((a, b) => d3.descending(a.count, b.count));
}
```

æ¥ç€å®šä¹‰ä¸¤ä¸ªæ–¹å‘ä¸Šçš„æ¯”ä¾‹å°ºï¼Œæ”¾åˆ°ä¸€ä¸ª `JavaScript` å¯¹è±¡é‡Œå¤‡ç”¨ï¼š

```js
scales = {
  const x = d3
    .scaleLinear()
    .domain([0, d3.max(data, (d) => d.count)])
    .range([0, 450]);

  const y = d3
    .scaleBand()
    .domain(data.map((d) => d.technology))
    .range([0, 700])
    .paddingInner(0.2);

  return { x, y };
}
```

ç„¶åå°±å¯ä»¥ç»˜åˆ¶æ¡å½¢å›¾äº†ï¼Œå®šä¹‰ä¸€ä¸ªå›¾è¡¨å˜é‡ `chart`ï¼š

```js
chart = {
  const svg = d3
    .create("svg")
    .attr("viewBox", "0 0 600 700")
    .attr("width", "100%")
  // .style('border', '1px solid black');

  const groups = svg
    .selectAll("g")
    .data(data)
    .join("g")
      .attr("transform", (d) => `translate(0, ${scales.y(d.technology)})`);

  // append rects
  appendRect(groups);

  // append tech name labels
  appendTechNameLabels(groups);

  // append count labels
  appendCountLabels(groups);

  // data binding part
  appendAxisLine(svg);

  return svg.node();
}
```

ç”±äºè¦åŠ æ³¨ä¸¤ç»„æ ‡ç­¾ï¼Œè¦ç”¨åˆ° `SVG` çš„åˆ†ç»„å…ƒç´ ï¼ˆ`g`ï¼‰ï¼Œè¿™é‡Œéœ€è¦ç°å°†æ•°æ®ç»‘å®šåˆ°æ¯ä¸ª `<g>` å…ƒç´ ä¸Šï¼ˆå¦‚ç¬¬ 8 è¡Œæ‰€ç¤ºï¼‰ã€‚ç„¶åç”¨ `groups` é€‰æ‹©é›†åˆ†åˆ«å®ŒæˆçŸ©å½¢æ¡ã€åç§°æ ‡ç­¾ä»¥åŠæ•°æ®æ ‡ç­¾çš„ç»‘å®šä¸ç»˜åˆ¶ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘æŠŠå®ƒä»¬éƒ½æåˆ°äº†å•ç‹¬çš„å•å…ƒæ ¼æ¥å¤„ç†ï¼ˆè·µè¡Œâ€œå•ä¸€èŒè´£â€åŸåˆ™ï¼‰ã€‚

å…ˆæ˜¯æŠ€æœ¯åç§°æ ‡ç­¾ã€‚æˆ‘å†åŸä¹¦å†…å®¹çš„åŸºç¡€ä¸Šï¼ŒæŠŠ `D3.js` å¯¹åº”çš„å¾—ç¥¨æ•°ä¹Ÿè®¾ç½®äº†ä¸€äº›æ ·å¼ï¼ˆåŠ ç²—ã€å˜è‰²ã€è°ƒæ•´å­—å·ï¼‰ï¼š

```js
function appendCountLabels(groups) {
  // Define predicates
  const target = 'D3.js';
  const fontSizeHightD3 = ({technology: t}) => 
    (t === target) ? '9px' : '8px';
  const fontWeightByTechName = ({technology: t}) => 
    (t === target) ? 700 : 400;
  const fillColorByTechName = ({technology: t}) => 
    (t === target) ? 'yellowgreen' : '#000';

  // Append labels
  groups
    .append('text')
      .attr('x', d => 100 + scales.x(d.count) + 4)
      .attr('y', 12)
      .text(d => d.count)
      .style('font-family', 'sans-serif')
      .style('font-weight', fontWeightByTechName)
      .style('font-size', fontSizeHightD3)
      .style('fill', fillColorByTechName);
}
```

æ•ˆæœè¿˜ä¸èµ–ï¼š

![](../../assets/3.36.4.png)

**å›¾ 4 å‡çº§ç‰ˆçš„ D3 æ•°æ®æ ‡ç­¾æ•ˆæœ**

æ¥ç€ç»˜åˆ¶çºµè½´æ ‡ç­¾ï¼ˆå¯¹åº”å„æŠ€æœ¯åç§°ï¼‰ï¼š

```js
function appendTechNameLabels(groups) {
  groups
    .append('text')
      .attr('x', 96)
      .attr('y', 12)
      .attr('text-anchor', 'end')
      .text(d => d.technology)
      .style('font-family', 'sans-serif')
      .style('font-size', '10px');
}
```

ç„¶åæ˜¯çŸ©å½¢æ¡ï¼š

```js
function appendRect(groups) {
  const byTechName = ({technology: t}) => 
    t === 'D3.js' ? 'yellowgreen' : 'skyblue';

  groups
    .append('rect')
      .attr('x', 100)
      .attr('y', 0)
      .attr('height', scales.y.bandwidth())
      .attr('width', d => scales.x(d.count))
      .attr('fill', byTechName);
}
```

æœ€åæ˜¯çºµè½´çš„é‚£æ¡ç›´çº¿ï¼š

```js
function appendAxisLine(svg) {
  svg
    .append('line')
      .attr('x1', 100)
      .attr('y1', 0)
      .attr('x2', 100)
      .attr('y2', 700)
      .attr('stroke', 'black');
}
```

ç„¶å <kbd>Shift</kbd> + <kbd>Enter</kbd> ä¸€é”®å‡ºå›¾ï¼š

![](../../assets/3.36.5.png)

**å›¾ 5 æœ€ç»ˆåœ¨ Observable å¹³å°ç»˜åˆ¶çš„åŠ æ³¨äº†å›¾è¡¨æ ‡ç­¾çš„ D3 æ¡å½¢å›¾æ•ˆæœ**



### 2.2 ç”¨ AI æç¤ºé‡æ„å•å…ƒæµ‹è¯•æ¨¡å—

æ¥ä¸‹æ¥æ‰æ˜¯æœ¬ç¯‡çš„é‡å¤´æˆâ€”â€”è‡ªå·±å°è£…ä¸€å¥— `describe` æ–¹æ³•å’Œ `it` æ–¹æ³•ã€‚è¿˜å¥½ `Observable` æ”¯æŒæ–­è¨€åº“ `Chai.js` çš„å¯¼å…¥ï¼Œå¯èƒ½åœ¨ **[Mike Bostock](https://bost.ocks.org/mike/)** å¤§ç¥çœ‹æ¥ï¼Œåªè¦æŠŠæ–­è¨€ç»“æœæ”¾åˆ°å•å…ƒæ ¼é‡Œå°±è¡Œäº†ï¼Œå¹²å˜›è¦å†™æˆ `describe` åµŒå¥— `it` çš„ç»“æ„å‘¢ï¼Ÿå¯¹äºæƒ³ç”¨ JS çš„å¾ªç¯ç»“æ„æ¥å†™æµ‹è¯•çš„ç ç•œçš„æƒ³æ³•ï¼Œå¤§ç¥å¯èƒ½æ— æš‡é¡¾åŠï¼š

```js
// è¿™æ˜¯æˆ‘ç²¾å¿ƒæ„å»ºçš„æµ‹è¯•æ•°æ®ï¼ˆå¤šä¹ˆä¼˜é›…~æˆ‘å±…ç„¶è¿˜ä¼šç”¨ Mapï¼‰
testData = new Map([
  [198, 83],
  [414, 173],
  [852, 256], // backup: 852 -> 356
  [1078, 450]
]);
```

æœ¬æ¥ã€å›¾1ã€‘æ˜¯å‡ºä¸æ¥æ•ˆæœçš„ï¼Œå› ä¸º `it_old` æ–¹æ³•æœ€åˆçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š

```js
/**
 * Test helper to display test title into the notebook
 */
function it_old(title, testFunction) {
  try {
    testFunction.call(this);
    return html`<div style="color:green;" >âœ“ : ${title || "Test passing "}</div>`;
  } catch (err) {
    return html`<div style="color:red;" >Ã— : ${err.message}</div>`;
  }
}
```

å¦‚æœä¸é€ä¸ªè¿”å›è¿è¡Œçš„ç»“æœï¼Œå°±ä¼šä¹±å¥—ï¼š

```js
invalidResults = {
  it_old("test1", () => expect(2).to.be.lessThan(1));
  it_old("test2", () => expect(5).to.be.lessThan(1));
  it_old("test3", () => expect(10).to.be.lessThan(1));
  it_old("test4", () => expect(100).to.be.lessThan(1));
}
```

è¿è¡Œå•å…ƒæ ¼åçœ‹ä¸åˆ°ä»»ä½•æŠ¥é”™ï¼š

![](../../assets/3.36.6.png)

**å›¾ 6 æ— æ³•å°†æµ‹è¯•ç»“æœæ­£ç¡®æ˜¾ç¤ºåˆ°é¡µé¢æ—§ç‰ˆ it æ–¹æ³•**

è¿™ä¹ˆä¸€æ¥ï¼Œæˆ‘è¦å°è£…çš„ `it` æ–¹æ³•å’Œ `describe` æ–¹æ³•ï¼Œå¿…é¡»è‡ªåŠ¨æ”¶é›†è¿™æ ·çš„æ–­è¨€ç»“æœæ‰è¡Œï¼Œè€Œä¸”è¿˜å¾—åœ¨åå°å®Œæˆï¼Œä¸ç„¶å¤ª lowï¼Œä¸æˆ‘çš„ç ç•œé£æ ¼ç›¸æ‚–ã€‚äºæ˜¯æˆ‘æƒ³åˆ°äº† `ES6` å¼•å…¥çš„ `class` è¯­æ³•ç³–ï¼Œå…ˆæŠŠ `describe` å’Œ `it` å®šä¹‰çš„å›è°ƒå‡½æ•°æ”¶é›†åˆ°ç±»çš„ä¸€ä¸ªæˆå‘˜æ•°ç»„ï¼Œè¿è¡Œçš„æ—¶å€™å†ç”¨ `this` å»æŒ¨ä¸ªéå†å®ƒä»¬ï¼Œç»“æœæ”¾åˆ°å¦ä¸€ä¸ªæ•°ç»„ï¼Œæœ€åç”¨ç»Ÿä¸€çš„æ¸²æŸ“å‡½æ•°äº¤å·ï¼Œä¸å°±æå®šäº†å—ï¼Ÿ

æƒ³æ³•æˆå½¢ï¼Œä¸‹ä¸€æ­¥å°±è®©æœºæ™ºçš„ AI å¸®æˆ‘å‡ºä¸ª 0.1 ç‰ˆå§ã€‚æœç„¶ï¼Œä¸æŠ±å¤ªå¤§å¸Œæœ›çš„æƒ…å†µä¸‹å¾€å¾€æœ‰æƒŠå–œï¼Œå±…ç„¶å¸®æˆ‘æŠŠ `beforeHooks` å’Œ `afterHooks` éƒ½å®ç°äº†ï¼ˆå…ˆä¸è®ºå¯¹é”™ï¼Œè¿™ä¹ˆç«¯æ­£çš„æ€åº¦å°±å€¼å¾—è¡¨æ‰¬ï¼‰ï¼š

```js
class TestSuite {
    constructor(name) {
        this.name = name;
        this.tests = [];
        this.beforeHooks = [];
        this.afterHooks = [];
    }

    describe(name, fn) {
        const suite = new TestSuite(name);
        fn.call(suite);
        this.tests.push(suite);
    }

    it(name, fn) {
        this.tests.push({ name, fn });
    }

    before(fn) {
        this.beforeHooks.push(fn);
    }

    after(fn) {
        this.afterHooks.push(fn);
    }

    async run() {
        console.log(`Running suite: ${this.name}`);
        
        // Run before hooks
        for (const hook of this.beforeHooks) {
            await hook();
        }

        for (const test of this.tests) {
            if (typeof test.fn === 'function') {
                try {
                    await test.fn();
                    console.log(`âœ”ï¸ ${test.name}`);
                } catch (error) {
                    console.error(`âŒ ${test.name}`);
                    console.error(error);
                }
            } else {
                // Recursively run nested suites
                await test.run();
            }
        }

        // Run after hooks
        for (const hook of this.afterHooks) {
            await hook();
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const suite = new TestSuite('My Test Suite');

suite.describe('Array', function() {
    this.before(() => {
        console.log('Setting up before tests...');
    });

    this.after(() => {
        console.log('Cleaning up after tests...');
    });

    this.it('should add items', async () => {
        const arr = [];
        arr.push(1);
        if (arr.length !== 1) throw new Error('Test failed');
    });

    this.it('should remove items', async () => {
        const arr = [1];
        arr.pop();
        if (arr.length === 0) throw new Error('Test failed');
    });
});

suite.run();
```

ç›´æ¥æ”¾åˆ° `Observable` å•å…ƒæ ¼è¿è¡Œï¼Œè™½ç„¶æœ‰å¾ˆå¤šå°é—®é¢˜ï¼Œä½†æ€»ç®—è¿˜åƒé‚£ä¹ˆå›äº‹ï¼š

![](../../assets/3.36.7.png)

**å›¾ 7 æ ¹æ® AI æç¤ºè¯ç”Ÿæˆçš„åˆ¶å®šä»£ç æ•ˆæœæˆªå›¾**



### 2.3 é›†æˆ Chai.js çš„ expect æ–­è¨€

AI ç‰ˆæœ¬è¿‡äºç²—ç³™ï¼Œéœ€è¦è°ƒæ•´å‡ ä¸ªåœ°æ–¹ï¼š

1. æ§åˆ¶å°è¾“å‡ºéœ€è¦æ”¹ä¸ºé¡µé¢æ˜¾ç¤ºï¼›
2. å„å•å…ƒæµ‹è¯•ç»“æœéœ€è¦åˆ†åˆ«æ”¶é›†èµ·æ¥ï¼›
3. æµ‹è¯•å¥—ä»¶å’Œç”¨ä¾‹æè¿°ä¹Ÿå¾—æ”¾åˆ°ç»“æœé‡Œï¼›
4. ç»Ÿä¸€æ•´ä½“è¾“å‡ºæ ·å¼ï¼ˆé¢œè‰²ã€ç¼©è¿›ç­‰ï¼‰ã€‚

é€ä¸€è§£å†³è¿™äº›å°ç‘•ç–µï¼Œäºæ˜¯å°±æœ‰äº† `v1.0` ç‰ˆçš„æµ‹è¯•ç±» `MyMocha`ï¼š

```js
// Define customized Mocha class
class MyMocha {
  constructor(name) {
    this.name = name;
    this.tests = [];
    this.results = [md`<div style="font-weight: 700;">ğŸš© ${name}</div>`];
    this.beforeHooks = [];
    this.afterHooks = [];
  }

  describe(name, fn) {
    const suite = new MyMocha(name);
    fn.call(suite);
    this.tests.push(suite);
    this.results.push(
      md`<div style="font-weight: 700; text-indent: 1em;">â³ <i>${name}</i></div>`
    );
  }

  it(name, fn) {
    this.tests.push({ name, fn });
  }

  before(fn) {
    this.beforeHooks.push(fn);
  }

  after(fn) {
    this.afterHooks.push(fn);
  }

  // show the results altogether in markdown format
  async showResults() {
    await this.run();
    return md`${this.results}`;
  }

  isFunction(fn) {
    return typeof fn === "function";
  }

  async run() {
    console.log(`Running suite: ${this.name}`);

    // Run before hooks
    for (const hook of this.beforeHooks) {
      await hook();
    }

    for (const test of this.tests) {
      if (this.isFunction(test.fn)) {
        try {
          await test.fn();
          this.results.push(
            html`<div style="color: green; text-indent: 2em;">âœ”ï¸ ${test.name}</div>`
          );
        } catch (error) {
          this.results.push(
            html`<div style="color:red; text-indent: 2em;">âŒ ${test.name}</div>`
          );
          this.results.push(
            html`<div style="color: red; text-indent: 3em;">${error.message}</div>`
          );
        }
      } else {
        // Recursively run nested suites
        await test.run();
      }
    }

    // Run after hooks
    for (const hook of this.afterHooks) {
      await hook();
    }
  }
}
```

ç„¶åæŠŠ `Chai.js` å¯¼å…¥ï¼Œå†æŠŠ `expect` æ–­è¨€æå‡ºæ¥ï¼š

```js
chai = import("https://unpkg.com/chai/chai.js");
expect = chai.expect.bind(chai);
```

å†™ä¸ªæµ‹è¯•çœ‹çœ‹ï¼š

```js
suite = {
  const testData = new Map([
    [198, 83],
    [414, 173],
    [852, 256], // backup: 852 -> 356
    [1078, 450]
  ]);

  const suite = new MyMocha("DIY mocha test:");
  const it = suite.it.bind(suite);
  const describe = suite.describe.bind(suite);

  describe("Testing horizontal scale for my bar chart:", () => {
    testData.forEach((expected, domain) => {
      it(`Pass the value ${domain} to the xScale() function, should return ${expected}.`, () => {
        const actual = scales.x(domain);
        const diff = Math.abs(actual - expected);
        expect(diff, "[Diff Exceeded]").to.be.lessThan(1);
      });
    });
  });

  return suite.showResults();
}
```

æ•ˆæœè¿˜è¡Œï¼š

![](../../assets/3.36.8.png)

**å›¾ 8 é›†æˆäº† Chai.js çš„ expect æ–­è¨€åçš„æµ‹è¯•ç”¨ä¾‹è¿è¡Œç»“æœ**



### 2.4 å¯¼å‡ºå®šåˆ¶çš„ MyMocha ç±»åŠç›¸å…³æ–­è¨€æ–¹æ³•

æ—¢ç„¶éƒ½æµ‹è¯•é€šè¿‡äº†ï¼Œå°±å¯ä»¥è€ƒè™‘æ”¾åˆ°ä¸€ä¸ªæ–°çš„ Notebook é‡Œï¼Œä¾›å…¶å®ƒè®°äº‹æœ¬å¯¼å…¥äº†ã€‚å’±ä¹Ÿæ¨¡ä»¿ä¸€ä¸‹å…¶ä»–ç½‘å‹çš„å¥—è·¯ï¼Œæä¸ªæ ‡é¢˜å’Œç”¨æ³•ç¤ºä¾‹ï¼š

![](../../assets/3.36.9.png)

**å›¾ 9 æ‹Ÿç”¨äºå¯¼å‡º MyMocha ç±»å’Œ expect æ–­è¨€çš„é€šç”¨ Notebook é¡µé¢**

ç„¶åå°†è¯¥é¡µé¢è®¾ç½®ä¸ºå…¬å¼€è®¿é—®ï¼Œå¹¶æ ¹æ® `Observable` çš„å®˜æ–¹æ–‡æ¡£ï¼Œç”¨è§„å®šçš„å¯¼å…¥è¯­æ³•å†å†™ä¸€ç‰ˆæµ‹è¯•ï¼š

![](../../assets/3.36.11.png)

**å›¾ 10 å°† Notebook è®°äº‹æœ¬é¡µé¢è®¾ç½®ä¸ºå…¬å¼€è®¿é—®**

![](../../assets/3.36.10.png)

**å›¾ 11 ä»é¡µé¢å³ä¾§è¾¹æ çš„å®˜æ–¹æ–‡æ¡£æ‰¾åˆ°å¯¼å…¥å…¶ä»–è®°äº‹æœ¬å•å…ƒæ ¼çš„å†™æ³•**

æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œå¯¼å…¥è¦è¿™ä¹ˆå†™ï¼š

```js
import { MyMocha, expect } from "@anton-playground/combined-unit-tests"
```

å†æµ‹ä¸€éï¼Œç»“æœå‘ç°ä¸€ä¸ª Bugï¼šæ¸²æŸ“å®Œæˆåæ²¡æœ‰åŠæ—¶æ¸…ç©ºæœ¬æ¬¡æµ‹è¯•ç»“æœï¼Œå¯¼è‡´é‡å¤è¿è¡Œåä¸Šæ¬¡çš„ç»“æœä¹Ÿåœ¨é‡Œé¢ã€‚äºæ˜¯åˆ‡å›å…¬å…±é¡µé¢æ”¹æ”¹æ¸²æŸ“å‡½æ•°çš„é€»è¾‘ï¼Œå‹‰å¼ºç®—æ˜¯ v1.1 ç‰ˆå§ï¼š

```js
// show the results altogether in markdown format
async showResults() {
  await this.run();
  const results = md`${this.results}`;
  this.tests = this.tests.filter((t) => !this.isFunction(t.fn));
  this.results = [];
  return results;
}
```

å†æµ‹ï¼Œå¤§åŠŸå‘Šæˆï¼š

![](../../assets/3.36.12.png)

**å›¾ 12 æœ€ç»ˆé€šè¿‡å¯¼å…¥å…¬å…±è®°äº‹æœ¬çš„è‡ªå®šä¹‰æ–¹æ³•å®ç°çš„æµ‹è¯•å¥—ä»¶çš„å®é™…æ•ˆæœ**



## 3 å°ç»“

è™½ç„¶æˆåŠŸæ¨¡æ‹Ÿäº† `Mocha.js` é‡Œçš„ `describe` å’Œ `it` åŸè¯­ï¼Œä½†æ¯•ç«Ÿé€»è¾‘è¿‡äºç®€å•ï¼Œç¨å¾®ä¸Šç‚¹æœ‰éš¾åº¦çš„æµ‹è¯•å°±ä¸å¤Ÿç”¨äº†ï¼Œè€Œä¸”å†™æ³•ä¸Šä¹Ÿæ²¡æœ‰ `Mocha.js` é‚£ä¹ˆè‡ªç„¶ï¼Œå¯¹äºé”šå®šçš„å‡ ä¸ª `hooks` é’©å­ä¹Ÿæ— æš‡éªŒè¯ã€‚è¿™ä¸ª Notebook å°±ç®—æŠ›ç –å¼•ç‰å§ï¼Œä»¥åå¯¹ `TDD` å’Œ `BDD` äº†è§£å¾—æ›´æ·±å…¥äº†å†æ¥å‡çº§ã€‚

ä¸¤ä¸ªè®°äº‹æœ¬é¡µé¢æˆ‘éƒ½å…±äº«å‡ºæ¥ï¼Œæ–¹ä¾¿å¤§å®¶å­¦ä¹ äº¤æµï¼ˆå¯ä»¥ Fork åˆ°è‡ªå·±çš„å·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰è¿›è¡Œä¿®æ”¹ï¼‰ï¼š

- å®šåˆ¶çš„ `MyMocha` æµ‹è¯•ç±»ï¼š[https://observablehq.com/@anton-playground/combined-unit-tests](https://observablehq.com/@anton-playground/combined-unit-tests)
- åŠ æ³¨æ ‡ç­¾çš„æ¡å½¢å›¾å¹¶é€šè¿‡çº¿æ€§æ¯”ä¾‹å°ºå•å…ƒæµ‹è¯•çš„ç¤ºä¾‹é¡µï¼š[https://observablehq.com/@anton-playground/my-bar-chart-with-chaijs](https://observablehq.com/@anton-playground/my-bar-chart-with-chaijs)



---

[^1]: æœåˆ°ä¸€ç¯‡å¯¹ Jest çš„ expect æ–¹æ³•çš„è½»é‡çº§å°è£…æ¡ˆä¾‹ï¼Œè¯¦è§ï¼š[Spencer: Unit testing inside a notebook](https://observablehq.com/@spensaur/unit-testing-inside-a-notebook)
[^2]: è¯¦è§ï¼š[Tom Larkworthy: Reactive Unit Testing and Reporting Framework](https://observablehq.com/@tomlarkworthy/testing) 

